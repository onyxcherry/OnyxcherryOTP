FROM python:3.9.1-slim-buster

RUN adduser --disabled-password --gecos "" onyxcherry
WORKDIR /home/onyxcherry/OnyxcherryOTP

RUN apt-get update && apt-get install -y --no-install-recommends git

COPY requirements.txt requirements.txt

RUN python -m venv venv && \
    venv/bin/pip install --upgrade pip && \
    venv/bin/pip install --no-cache-dir -r requirements.txt && \
    venv/bin/pip install --no-cache-dir  gunicorn==20.0.4 psycopg2-binary

RUN chown -R onyxcherry:onyxcherry ./
USER onyxcherry

EXPOSE 5777

CMD ["venv/bin/gunicorn", "-b", ":5777", "--reload", "--access-logfile", "-", "--error-logfile", "-", "onyxcherryotp:app"]
